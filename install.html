<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é£è±¡åŠ©æ‰‹å®‰è£…</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; text-align: center; padding: 50px; background: #f5f7fa; color: #333; }
        .card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); max-width: 600px; margin: 0 auto; border: 1px solid #eee; }
        h1 { margin-bottom: 30px; font-size: 24px; }
        .bookmark-btn {
            display: inline-block;
            background: #0071fd;
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(0,113,253,0.3);
            cursor: grab;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        .bookmark-btn:active { cursor: grabbing; transform: scale(0.98); }
        .step { color: #666; font-size: 16px; margin: 10px 0; }
        .arrow { font-size: 24px; color: #ccc; margin: 15px 0; }
        kbd { background: #eee; border-radius: 4px; padding: 2px 6px; font-size: 12px; border: 1px solid #ddd; font-family: monospace; }
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸ› ï¸ é£è±¡è·¨å±åŠ©æ‰‹å®‰è£… (ä¿®å¤ç‰ˆ)</h1>
    
    <div class="step">è¯·å°†ä¸‹æ–¹çš„è“è‰²æŒ‰é’®</div>
    <div class="arrow">ğŸ‘‡</div>
    <div class="step">æ‹–æ‹½åˆ°æµè§ˆå™¨çš„ <b>ä¹¦ç­¾æ  (æ”¶è—å¤¹)</b></div>
    
    <br>

    <!-- 
      æ ¸å¿ƒä¿®å¤ç‚¹ï¼š
      1. å¢åŠ äº† JSON.parse çš„å®¹é”™ã€‚
      2. å¢åŠ äº† document.activeElement çš„åˆ¤ç©ºä¿æŠ¤ã€‚
      3. å¢åŠ äº† navigator.clipboard çš„ fallback æœºåˆ¶ã€‚
      4. å³ä½¿è‡ªåŠ¨å¡«å…¥å¤±è´¥ï¼Œä¹Ÿä¼šå¼ºè¡ŒæŠŠæ–‡å­—æ˜¾ç¤ºåœ¨æµ®çª—ä¸Šï¼Œç¡®ä¿ç”¨æˆ·èƒ½çœ‹åˆ°ã€‚
    -->
    <a href="javascript:(function(){
        /* é…ç½® */
        var HOST='https://xiaolu-ai.github.io/wailiantalk/mobile.html';
        var KEY='Mk5nC300w1sl179427027p34986797';
        var CLUSTER='free.blr2.piesocket.com';
        
        if(document.getElementById('fx-box')) return alert('æ’ä»¶å·²åœ¨è¿è¡Œ');
        
        var rid = 'fx_' + Math.random().toString(36).substr(2,5);
        var url = HOST + '?room=' + rid;
        
        /* UI */
        var box = document.createElement('div');
        box.id = 'fx-box';
        box.style.cssText = 'position:fixed;top:20px;right:20px;z-index:2147483647;width:180px;background:white;padding:15px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.15);text-align:center;font-family:sans-serif;border:1px solid #eee';
        
        var close = document.createElement('div');
        close.innerHTML = 'Ã—';
        close.style.cssText = 'position:absolute;right:10px;top:5px;cursor:pointer;font-size:20px;color:#999;width:20px;height:20px;line-height:20px;';
        close.onclick = function(){ ws.close(); box.remove(); };
        
        var img = document.createElement('img');
        img.src = 'https://api.qrserver.com/v1/create-qr-code/?size=140x140&margin=0&data=' + encodeURIComponent(url);
        img.style.cssText = 'width:140px;height:140px;display:block;margin:0 auto 10px;background:#f5f5f5';
        
        var msg = document.createElement('div');
        msg.id = 'fx-msg';
        msg.innerText = 'ç­‰å¾…æ‰‹æœºè¿æ¥...';
        msg.style.cssText = 'color:#666;font-size:13px;margin-bottom:10px;padding:8px;background:#f9f9f9;border-radius:4px;word-break:break-all;min-height:20px;line-height:1.4;';
        
        var btn = document.createElement('button');
        btn.innerText = 'å¤åˆ¶å†…å®¹';
        btn.style.cssText = 'background:#0071fd;color:white;border:none;padding:10px;border-radius:6px;cursor:pointer;width:100%;font-size:14px;font-weight:bold;';
        btn.onclick = function(){
            var txt = msg.getAttribute('data-text');
            if(!txt) return alert('æš‚æ— å†…å®¹');
            navigator.clipboard.writeText(txt).then(function(){
                var old = btn.innerText;
                btn.innerText = 'âœ… å·²å¤åˆ¶';
                btn.style.background = '#07c160';
                setTimeout(function(){ btn.innerText = old; btn.style.background = '#0071fd'; }, 1000);
            }).catch(function(){
                prompt('è¯·æ‰‹åŠ¨å¤åˆ¶:', txt);
            });
        };
        
        box.appendChild(close);
        box.appendChild(img);
        box.appendChild(msg);
        box.appendChild(btn);
        document.body.appendChild(box);
        
        /* WebSocket */
        var ws = new WebSocket('wss://' + CLUSTER + '/v3/' + rid + '?api_key=' + KEY + '&notify_self=0');
        
        ws.onopen = function(){
            msg.innerText = 'ğŸŸ¢ æ‰«ç è¿æ¥æˆåŠŸ';
            msg.style.color = 'green';
        };
        
        ws.onmessage = function(e){
            try {
                var d = JSON.parse(e.data);
                if(d.text){
                    // 1. æ˜¾ç¤ºæ–‡å­—
                    msg.innerText = d.text;
                    msg.setAttribute('data-text', d.text);
                    msg.style.color = '#333';
                    msg.style.fontWeight = 'bold';
                    
                    // 2. å°è¯•è‡ªåŠ¨å¡«å…¥
                    var el = document.activeElement;
                    if(el && (el.tagName == 'INPUT' || el.tagName == 'TEXTAREA')){
                        el.value = d.text;
                        el.dispatchEvent(new Event('input', {bubbles:true}));
                        msg.style.border = '1px solid #07c160';
                        setTimeout(function(){ msg.style.border = 'none'; }, 500);
                    }
                    
                    // 3. å°è¯•è‡ªåŠ¨å¤åˆ¶
                    navigator.clipboard.writeText(d.text).catch(function(){});
                }
            } catch(err){
                console.error(err);
            }
        };
        
        ws.onerror = function(){
            msg.innerText = 'âŒ ç½‘ç»œè¿æ¥é”™è¯¯';
            msg.style.color = 'red';
        };
        
    })()" class="bookmark-btn" onclick="alert('è¯·æ‹–æ‹½æˆ‘åˆ°ä¹¦ç­¾æ ï¼Œä¸è¦ç›´æ¥ç‚¹å‡»å“¦ï¼');return false;">
        ğŸš€ é£è±¡äº‘è¾“å…¥ (Fix)
    </a>

    <br><br>
    <div style="font-size:12px; color:#999;">
        æç¤ºï¼šå¦‚æœæ²¡çœ‹åˆ°ä¹¦ç­¾æ ï¼Œè¯·æŒ‰ <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>B</kbd> (MacæŒ‰ <kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>B</kbd>)
    </div>
</div>

</body>
</html>
